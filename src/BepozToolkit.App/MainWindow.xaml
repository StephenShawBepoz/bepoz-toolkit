<Window x:Class="BepozToolkit.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:vm="clr-namespace:BepozToolkit.App.ViewModels"
        xmlns:views="clr-namespace:BepozToolkit.App.Views"
        mc:Ignorable="d"
        d:DataContext="{d:DesignInstance Type=vm:MainViewModel, IsDesignTimeCreatable=False}"
        Title="Bepoz Toolkit"
        Width="1280" Height="800"
        MinWidth="960" MinHeight="640"
        WindowStyle="None"
        AllowsTransparency="False"
        UseLayoutRounding="True"
        SnapsToDevicePixels="True"
        Background="{DynamicResource BackgroundPrimary}"
        Loaded="Window_Loaded"
        Closing="Window_Closing">

    <!-- ================================================================
         Custom Window Chrome
         ================================================================ -->
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="40"
                      CornerRadius="0"
                      GlassFrameThickness="0"
                      ResizeBorderThickness="6"
                      UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>

    <!-- Keyboard shortcuts -->
    <Window.InputBindings>
        <KeyBinding Key="R" Modifiers="Control" Command="{Binding RefreshCommand}" />
        <KeyBinding Key="D1" Modifiers="Control" Command="{Binding NavigateCommand}" CommandParameter="Dashboard" />
        <KeyBinding Key="D2" Modifiers="Control" Command="{Binding NavigateCommand}" CommandParameter="Tools" />
        <KeyBinding Key="D3" Modifiers="Control" Command="{Binding NavigateCommand}" CommandParameter="Logs" />
        <KeyBinding Key="D4" Modifiers="Control" Command="{Binding NavigateCommand}" CommandParameter="Settings" />
    </Window.InputBindings>

    <Grid>
        <DockPanel LastChildFill="True">

            <!-- ==============================================================
                 TITLE BAR
                 ============================================================== -->
            <Border DockPanel.Dock="Top"
                    Background="{DynamicResource TitleBarBackground}"
                    Height="40">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Left: Logo / brand -->
                    <StackPanel Grid.Column="0"
                                Orientation="Horizontal"
                                VerticalAlignment="Center"
                                Margin="14,0,0,0">
                        <!-- Bepoz "B" icon -->
                        <Border Background="{DynamicResource AccentSecondary}"
                                Width="22" Height="22"
                                CornerRadius="4"
                                Margin="0,0,10,0">
                            <TextBlock Text="B"
                                       FontSize="13"
                                       FontWeight="Bold"
                                       Foreground="#212121"
                                       HorizontalAlignment="Center"
                                       VerticalAlignment="Center" />
                        </Border>
                        <TextBlock Text="{Binding AppTitle}"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TitleBarForeground}"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{Binding AppVersion}"
                                   FontSize="10"
                                   Foreground="{DynamicResource TitleBarForeground}"
                                   Opacity="0.6"
                                   VerticalAlignment="Center"
                                   Margin="8,2,0,0" />
                    </StackPanel>

                    <!-- Center: draggable area (handled by WindowChrome CaptionHeight) -->

                    <!-- Right: theme toggle + window buttons -->
                    <StackPanel Grid.Column="2"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">

                        <!-- Theme toggle button -->
                        <Button Style="{DynamicResource TitleBarButton}"
                                Command="{Binding ToggleThemeCommand}"
                                ToolTip="Toggle theme (light/dark)"
                                Width="40">
                            <materialDesign:PackIcon Kind="{Binding IsDarkTheme, Converter={StaticResource BoolToThemeIconConverter}, FallbackValue=WeatherSunny}"
                                                     Width="16" Height="16" />
                        </Button>

                        <Rectangle Width="1" Fill="{DynamicResource TitleBarForeground}"
                                   Opacity="0.2" Margin="2,8" />

                        <!-- Minimize -->
                        <Button Style="{DynamicResource TitleBarButton}"
                                Click="MinimizeButton_Click"
                                ToolTip="Minimize">
                            <materialDesign:PackIcon Kind="WindowMinimize" Width="16" Height="16" />
                        </Button>

                        <!-- Maximize / Restore -->
                        <Button x:Name="MaximizeRestoreButton"
                                Style="{DynamicResource TitleBarButton}"
                                Click="MaximizeRestoreButton_Click"
                                ToolTip="Maximize">
                            <materialDesign:PackIcon x:Name="MaximizeRestoreIcon"
                                                     Kind="WindowMaximize"
                                                     Width="16" Height="16" />
                        </Button>

                        <!-- Close -->
                        <Button Style="{DynamicResource TitleBarCloseButton}"
                                Click="CloseButton_Click"
                                ToolTip="Close">
                            <materialDesign:PackIcon Kind="WindowClose" Width="16" Height="16" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ==============================================================
                 OFFLINE BANNER (hidden by default)
                 ============================================================== -->
            <Border DockPanel.Dock="Top"
                    Style="{DynamicResource OfflineBanner}"
                    Visibility="{Binding IsOffline, Converter={StaticResource BooleanToVisibilityConverter}}">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <materialDesign:PackIcon Kind="CloudOffOutline"
                                             Width="16" Height="16"
                                             Foreground="{DynamicResource OfflineBannerForeground}"
                                             VerticalAlignment="Center"
                                             Margin="0,0,8,0" />
                    <TextBlock Style="{DynamicResource OfflineBannerText}"
                               Text="You are offline. Cached tools are available; some features may be limited." />
                </StackPanel>
            </Border>

            <!-- ==============================================================
                 TAB NAVIGATION BAR
                 ============================================================== -->
            <Border DockPanel.Dock="Top"
                    Background="{DynamicResource TabBackground}"
                    BorderBrush="{DynamicResource DividerColor}"
                    BorderThickness="0,0,0,1">
                <StackPanel Orientation="Horizontal" Margin="8,0">
                    <RadioButton Style="{DynamicResource NavTabButton}"
                                 IsChecked="{Binding IsDashboardSelected, Mode=OneWay}"
                                 Command="{Binding NavigateCommand}"
                                 CommandParameter="Dashboard">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="ViewDashboardOutline"
                                                     Width="18" Height="18"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0" />
                            <TextBlock Text="Dashboard" VerticalAlignment="Center" />
                        </StackPanel>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource NavTabButton}"
                                 IsChecked="{Binding IsToolsSelected, Mode=OneWay}"
                                 Command="{Binding NavigateCommand}"
                                 CommandParameter="Tools">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="WrenchOutline"
                                                     Width="18" Height="18"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0" />
                            <TextBlock Text="Tools" VerticalAlignment="Center" />
                        </StackPanel>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource NavTabButton}"
                                 IsChecked="{Binding IsLogsSelected, Mode=OneWay}"
                                 Command="{Binding NavigateCommand}"
                                 CommandParameter="Logs">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="TextBoxOutline"
                                                     Width="18" Height="18"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0" />
                            <TextBlock Text="Logs" VerticalAlignment="Center" />
                        </StackPanel>
                    </RadioButton>

                    <RadioButton Style="{DynamicResource NavTabButton}"
                                 IsChecked="{Binding IsSettingsSelected, Mode=OneWay}"
                                 Command="{Binding NavigateCommand}"
                                 CommandParameter="Settings">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CogOutline"
                                                     Width="18" Height="18"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,8,0" />
                            <TextBlock Text="Settings" VerticalAlignment="Center" />
                        </StackPanel>
                    </RadioButton>
                </StackPanel>
            </Border>

            <!-- ==============================================================
                 STATUS BAR (bottom)
                 ============================================================== -->
            <Border DockPanel.Dock="Bottom"
                    Background="{DynamicResource BackgroundSecondary}"
                    BorderBrush="{DynamicResource DividerColor}"
                    BorderThickness="0,1,0,0"
                    Padding="12,6">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Left: version info -->
                    <TextBlock Grid.Column="0"
                               Style="{DynamicResource CaptionText}"
                               VerticalAlignment="Center">
                        <Run Text="{Binding AppTitle, Mode=OneTime}" />
                        <Run Text="{Binding AppVersion, Mode=OneTime}" />
                    </TextBlock>

                    <!-- Right: health status pills -->
                    <StackPanel Grid.Column="1"
                                Orientation="Horizontal"
                                VerticalAlignment="Center">

                        <!-- GitHub Status Pill -->
                        <Border Margin="0,0,8,0">
                            <Border.Style>
                                <Style TargetType="Border" BasedOn="{StaticResource StatusPillBase}">
                                    <Setter Property="Background" Value="{DynamicResource InfoBackground}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding GitHubStatusLevel}" Value="Success">
                                            <Setter Property="Background" Value="{DynamicResource SuccessBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding GitHubStatusLevel}" Value="Error">
                                            <Setter Property="Background" Value="{DynamicResource ErrorBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding GitHubStatusLevel}" Value="Warning">
                                            <Setter Property="Background" Value="{DynamicResource WarningBackground}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Github" Width="14" Height="14"
                                                         VerticalAlignment="Center"
                                                         Foreground="{DynamicResource TextSecondary}"
                                                         Margin="0,0,6,0" />
                                <TextBlock Style="{DynamicResource StatusPillText}"
                                           Text="{Binding GitHubStatus}"
                                           Foreground="{DynamicResource TextSecondary}" />
                            </StackPanel>
                        </Border>

                        <!-- Cache Status Pill -->
                        <Border Margin="0,0,8,0">
                            <Border.Style>
                                <Style TargetType="Border" BasedOn="{StaticResource StatusPillBase}">
                                    <Setter Property="Background" Value="{DynamicResource InfoBackground}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding CacheStatusLevel}" Value="Success">
                                            <Setter Property="Background" Value="{DynamicResource SuccessBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding CacheStatusLevel}" Value="Error">
                                            <Setter Property="Background" Value="{DynamicResource ErrorBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding CacheStatusLevel}" Value="Warning">
                                            <Setter Property="Background" Value="{DynamicResource WarningBackground}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="DatabaseOutline" Width="14" Height="14"
                                                         VerticalAlignment="Center"
                                                         Foreground="{DynamicResource TextSecondary}"
                                                         Margin="0,0,6,0" />
                                <TextBlock Style="{DynamicResource StatusPillText}"
                                           Text="{Binding CacheStatus}"
                                           Foreground="{DynamicResource TextSecondary}" />
                            </StackPanel>
                        </Border>

                        <!-- PowerShell Status Pill -->
                        <Border>
                            <Border.Style>
                                <Style TargetType="Border" BasedOn="{StaticResource StatusPillBase}">
                                    <Setter Property="Background" Value="{DynamicResource InfoBackground}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding PsStatusLevel}" Value="Success">
                                            <Setter Property="Background" Value="{DynamicResource SuccessBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding PsStatusLevel}" Value="Error">
                                            <Setter Property="Background" Value="{DynamicResource ErrorBackground}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding PsStatusLevel}" Value="Warning">
                                            <Setter Property="Background" Value="{DynamicResource WarningBackground}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="PowerShell" Width="14" Height="14"
                                                         VerticalAlignment="Center"
                                                         Foreground="{DynamicResource TextSecondary}"
                                                         Margin="0,0,6,0" />
                                <TextBlock Style="{DynamicResource StatusPillText}"
                                           Text="{Binding PsStatus}"
                                           Foreground="{DynamicResource TextSecondary}" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- ==============================================================
                 MAIN CONTENT AREA
                 ============================================================== -->
            <Grid>
                <!-- Content that switches based on selected tab -->
                <Grid>
                    <!-- Dashboard -->
                    <views:DashboardView x:Name="DashboardContent"
                        Visibility="{Binding IsDashboardSelected, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <!-- Tools -->
                    <views:ToolsView x:Name="ToolsContent"
                        Visibility="{Binding IsToolsSelected, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <!-- Logs -->
                    <views:LogsView x:Name="LogsContent"
                        Visibility="{Binding IsLogsSelected, Converter={StaticResource BooleanToVisibilityConverter}}" />

                    <!-- Settings -->
                    <views:SettingsView x:Name="SettingsContent"
                        Visibility="{Binding IsSettingsSelected, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </Grid>

                <!-- ==============================================================
                     TOAST NOTIFICATION OVERLAY (top-right)
                     ============================================================== -->
                <ItemsControl ItemsSource="{Binding ActiveToasts}"
                              HorizontalAlignment="Right"
                              VerticalAlignment="Top"
                              Margin="0,12,16,0"
                              IsHitTestVisible="True">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{DynamicResource ToastBorder}"
                                    Margin="0,0,0,8">
                                <Border.BorderBrush>
                                    <SolidColorBrush Color="{Binding Type,
                                        Converter={StaticResource ToastTypeToColorConverter},
                                        FallbackValue=#2196F3}" />
                                </Border.BorderBrush>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="4" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Colored accent bar on left -->
                                    <Border Grid.Column="0"
                                            CornerRadius="2"
                                            Margin="0,0,12,0">
                                        <Border.Background>
                                            <SolidColorBrush Color="{Binding Type,
                                                Converter={StaticResource ToastTypeToColorConverter},
                                                FallbackValue=#2196F3}" />
                                        </Border.Background>
                                    </Border>

                                    <!-- Content -->
                                    <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Title}"
                                                   FontWeight="SemiBold"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource TextPrimary}" />
                                        <TextBlock Text="{Binding Message}"
                                                   FontSize="12"
                                                   Foreground="{DynamicResource TextSecondary}"
                                                   TextWrapping="Wrap"
                                                   Margin="0,2,0,0" />
                                    </StackPanel>

                                    <!-- Dismiss -->
                                    <Button Grid.Column="2"
                                            Style="{DynamicResource BepozGhostButton}"
                                            Command="{Binding DataContext.DismissToastCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            VerticalAlignment="Top"
                                            Padding="4">
                                        <materialDesign:PackIcon Kind="Close" Width="14" Height="14" />
                                    </Button>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </Grid>
        </DockPanel>

        <!-- Window border (1px) for non-maximized state -->
        <Border BorderBrush="{DynamicResource AccentPrimary}"
                BorderThickness="1"
                IsHitTestVisible="False"
                x:Name="WindowBorderOverlay" />
    </Grid>
</Window>
