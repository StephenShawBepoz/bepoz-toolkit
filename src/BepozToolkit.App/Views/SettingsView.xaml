<UserControl x:Class="BepozToolkit.App.Views.SettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:BepozToolkit.App.Converters"
             xmlns:vm="clr-namespace:BepozToolkit.App.ViewModels"
             d:DataContext="{d:DesignInstance vm:SettingsViewModel}"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             mc:Ignorable="d"
             Background="{DynamicResource BackgroundPrimary}">

    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibility" />
        <converters:FileSizeConverter x:Key="FileSizeConverter" />
        <converters:InverseBoolConverter x:Key="InverseBool" />
        <converters:StringNotEmptyToVisibilityConverter x:Key="StringNotEmptyToVisibility" />

        <!-- Section Header Style -->
        <Style x:Key="SectionHeader" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16" />
            <Setter Property="FontWeight" Value="SemiBold" />
            <Setter Property="Foreground" Value="{DynamicResource TextPrimary}" />
            <Setter Property="Margin" Value="0,0,0,12" />
        </Style>

        <!-- Field Label Style -->
        <Style x:Key="FieldLabel" TargetType="TextBlock">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="Foreground" Value="{DynamicResource TextSecondary}" />
            <Setter Property="Margin" Value="0,0,0,4" />
        </Style>

        <!-- Card Style -->
        <Style x:Key="SettingsCard" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource CardBackground}" />
            <Setter Property="BorderBrush" Value="{DynamicResource CardBorder}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="CornerRadius" Value="8" />
            <Setter Property="Padding" Value="20" />
            <Setter Property="Margin" Value="0,0,0,16" />
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="1" BlurRadius="6" Opacity="0.08" />
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="24">
        <StackPanel Margin="24">
            <!-- Loading -->
            <ProgressBar IsIndeterminate="True" Height="2" Margin="0,0,0,8"
                         Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibility}}" />

            <!-- ====== GitHub Config Section ====== -->
            <Border Style="{StaticResource SettingsCard}">
                <StackPanel>
                    <TextBlock Text="GitHub Configuration" Style="{StaticResource SectionHeader}" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="16" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Owner" Style="{StaticResource FieldLabel}" />
                        <TextBox Grid.Column="0" Grid.Row="1"
                                 Text="{Binding GitHubOwner, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="13" Padding="8,6" />

                        <TextBlock Grid.Column="2" Grid.Row="0" Text="Repository" Style="{StaticResource FieldLabel}" />
                        <TextBox Grid.Column="2" Grid.Row="1"
                                 Text="{Binding GitHubRepo, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="13" Padding="8,6" />

                        <TextBlock Grid.Column="4" Grid.Row="0" Text="Branch" Style="{StaticResource FieldLabel}" />
                        <TextBox Grid.Column="4" Grid.Row="1"
                                 Text="{Binding GitHubBranch, UpdateSourceTrigger=PropertyChanged}"
                                 FontSize="13" Padding="8,6" />
                    </Grid>

                    <!-- Cache Expiration Slider -->
                    <TextBlock Text="Cache Expiration" Style="{StaticResource FieldLabel}" Margin="0,16,0,4" />
                    <DockPanel>
                        <TextBlock DockPanel.Dock="Right" Width="60" TextAlignment="Right"
                                   FontSize="12" Foreground="{DynamicResource TextSecondary}"
                                   VerticalAlignment="Center">
                            <TextBlock.Text>
                                <Binding Path="CacheExpirationMinutes" StringFormat="{}{0} min" />
                            </TextBlock.Text>
                        </TextBlock>
                        <Slider Minimum="5" Maximum="480" TickFrequency="5" IsSnapToTickEnabled="True"
                                Value="{Binding CacheExpirationMinutes}" />
                    </DockPanel>
                </StackPanel>
            </Border>

            <!-- ====== Database Connections Section ====== -->
            <Border Style="{StaticResource SettingsCard}">
                <StackPanel>
                    <DockPanel Margin="0,0,0,12">
                        <TextBlock Text="Database Connections" Style="{StaticResource SectionHeader}"
                                   DockPanel.Dock="Left" Margin="0" />
                        <StackPanel DockPanel.Dock="Right" Orientation="Horizontal"
                                    HorizontalAlignment="Right">
                            <Button Content="Add" Padding="10,5" Margin="0,0,6,0"
                                    Command="{Binding AddConnectionCommand}"
                                    Background="{DynamicResource AccentPrimary}"
                                    Foreground="{DynamicResource TextOnAccent}"
                                    BorderThickness="0" Cursor="Hand" FontSize="12">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" />
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <Button Content="Save" Padding="10,5" Margin="0,0,6,0"
                                    Command="{Binding EditConnectionCommand}"
                                    Background="{DynamicResource SuccessColor}"
                                    Foreground="{DynamicResource TextOnAccent}"
                                    BorderThickness="0" Cursor="Hand" FontSize="12">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" />
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <Button Content="Delete" Padding="10,5" Margin="0,0,6,0"
                                    Command="{Binding DeleteConnectionCommand}"
                                    Background="{DynamicResource ErrorColor}"
                                    Foreground="{DynamicResource TextOnAccent}"
                                    BorderThickness="0" Cursor="Hand" FontSize="12">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" />
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                            <Button Content="Test" Padding="10,5"
                                    Command="{Binding TestConnectionCommand}"
                                    Background="{DynamicResource InfoColor}"
                                    Foreground="{DynamicResource TextOnAccent}"
                                    BorderThickness="0" Cursor="Hand" FontSize="12">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" />
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </StackPanel>
                    </DockPanel>

                    <!-- Connections DataGrid -->
                    <DataGrid ItemsSource="{Binding SavedConnections}"
                              SelectedItem="{Binding SelectedConnection}"
                              AutoGenerateColumns="False" CanUserAddRows="False"
                              CanUserDeleteRows="False" IsReadOnly="False"
                              SelectionMode="Single" GridLinesVisibility="Horizontal"
                              BorderThickness="1" BorderBrush="{DynamicResource CardBorder}"
                              Background="{DynamicResource BackgroundSecondary}"
                              RowBackground="{DynamicResource BackgroundSecondary}"
                              AlternatingRowBackground="{DynamicResource BackgroundTertiary}"
                              FontSize="12" MinHeight="120" MaxHeight="250">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
                            <DataGridTextColumn Header="Server" Binding="{Binding Server}" Width="*" />
                            <DataGridTextColumn Header="Database" Binding="{Binding DatabaseName}" Width="*" />
                            <DataGridComboBoxColumn Header="Auth Type" Width="100"
                                                    SelectedItemBinding="{Binding AuthType}">
                                <DataGridComboBoxColumn.ItemsSource>
                                    <x:Array Type="sys:String"
                                             xmlns:sys="clr-namespace:System;assembly=System.Runtime">
                                        <sys:String>Windows</sys:String>
                                        <sys:String>SQL</sys:String>
                                    </x:Array>
                                </DataGridComboBoxColumn.ItemsSource>
                            </DataGridComboBoxColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <!-- Test Result -->
                    <TextBlock Text="{Binding TestResult}" FontSize="12" Margin="0,8,0,0"
                               Foreground="{DynamicResource TextSecondary}"
                               Visibility="{Binding TestResult, Converter={StaticResource StringNotEmptyToVisibility}}" />
                </StackPanel>
            </Border>

            <!-- ====== Appearance Section ====== -->
            <Border Style="{StaticResource SettingsCard}">
                <StackPanel>
                    <TextBlock Text="Appearance" Style="{StaticResource SectionHeader}" />

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="16" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="16" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <!-- Theme Toggle -->
                        <TextBlock Grid.Column="0" Grid.Row="0" Text="Theme"
                                   Style="{StaticResource FieldLabel}" VerticalAlignment="Center" />
                        <StackPanel Grid.Column="1" Grid.Row="0" Orientation="Horizontal"
                                    HorizontalAlignment="Right">
                            <RadioButton Content="Light" GroupName="Theme" FontSize="13"
                                         IsChecked="{Binding IsDarkTheme, Converter={StaticResource InverseBool}}"
                                         Margin="0,0,16,0" VerticalContentAlignment="Center" />
                            <RadioButton Content="Dark" GroupName="Theme" FontSize="13"
                                         IsChecked="{Binding IsDarkTheme}"
                                         VerticalContentAlignment="Center" />
                        </StackPanel>

                        <!-- Animation Toggle -->
                        <TextBlock Grid.Column="0" Grid.Row="2" Text="Enable Animations"
                                   Style="{StaticResource FieldLabel}" VerticalAlignment="Center" />
                        <CheckBox Grid.Column="1" Grid.Row="2"
                                  IsChecked="{Binding EnableAnimations}"
                                  HorizontalAlignment="Right" VerticalAlignment="Center" />

                        <!-- Toast Notifications -->
                        <TextBlock Grid.Column="0" Grid.Row="4" Text="Toast Notifications"
                                   Style="{StaticResource FieldLabel}" VerticalAlignment="Center" />
                        <CheckBox Grid.Column="1" Grid.Row="4"
                                  IsChecked="{Binding EnableToastNotifications}"
                                  HorizontalAlignment="Right" VerticalAlignment="Center" />
                    </Grid>
                </StackPanel>
            </Border>

            <!-- ====== Advanced Section ====== -->
            <Border Style="{StaticResource SettingsCard}">
                <StackPanel>
                    <TextBlock Text="Advanced" Style="{StaticResource SectionHeader}" />

                    <!-- Log Level -->
                    <Grid Margin="0,0,0,16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="200" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0" Text="Log Level" Style="{StaticResource FieldLabel}"
                                   VerticalAlignment="Center" />
                        <ComboBox Grid.Column="1" ItemsSource="{Binding LogLevels}"
                                  SelectedItem="{Binding LogLevel}"
                                  FontSize="13" VerticalContentAlignment="Center" />
                    </Grid>

                    <!-- Cache Info -->
                    <Border Background="{DynamicResource BackgroundTertiary}"
                            CornerRadius="6" Padding="16,12" Margin="0,0,0,16">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Column="0">
                                <TextBlock FontSize="13" Foreground="{DynamicResource TextPrimary}">
                                    <Run Text="Cache:" FontWeight="SemiBold" />
                                    <Run Text="{Binding CacheSize, Converter={StaticResource FileSizeConverter}, Mode=OneWay}" />
                                    <Run Text=" (" />
                                    <Run Text="{Binding CacheFileCount, Mode=OneWay}" />
                                    <Run Text=" files)" />
                                </TextBlock>
                            </StackPanel>
                            <Button Grid.Column="1" Content="Clear Cache" Padding="12,6"
                                    Command="{Binding ClearCacheCommand}"
                                    Background="{DynamicResource WarningColor}"
                                    Foreground="{DynamicResource TextOnAccent}"
                                    BorderThickness="0" Cursor="Hand" FontSize="12">
                                <Button.Template>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}"
                                                CornerRadius="4" Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" />
                                        </Border>
                                    </ControlTemplate>
                                </Button.Template>
                            </Button>
                        </Grid>
                    </Border>

                    <!-- Keyboard Shortcuts Reference -->
                    <TextBlock Text="Keyboard Shortcuts" FontSize="13" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimary}" Margin="0,0,0,8" />
                    <Border Background="{DynamicResource BackgroundTertiary}"
                            CornerRadius="6" Padding="16,12" Margin="0,0,0,16">
                        <StackPanel>
                            <Grid Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Ctrl+1..4" FontFamily="Consolas"
                                           FontSize="12" Foreground="{DynamicResource AccentPrimary}" />
                                <TextBlock Grid.Column="1" Text="Switch tabs"
                                           FontSize="12" Foreground="{DynamicResource TextSecondary}" />
                            </Grid>
                            <Grid Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Ctrl+R" FontFamily="Consolas"
                                           FontSize="12" Foreground="{DynamicResource AccentPrimary}" />
                                <TextBlock Grid.Column="1" Text="Refresh current view"
                                           FontSize="12" Foreground="{DynamicResource TextSecondary}" />
                            </Grid>
                            <Grid Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Ctrl+F" FontFamily="Consolas"
                                           FontSize="12" Foreground="{DynamicResource AccentPrimary}" />
                                <TextBlock Grid.Column="1" Text="Focus search"
                                           FontSize="12" Foreground="{DynamicResource TextSecondary}" />
                            </Grid>
                            <Grid Margin="0,0,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Escape" FontFamily="Consolas"
                                           FontSize="12" Foreground="{DynamicResource AccentPrimary}" />
                                <TextBlock Grid.Column="1" Text="Minimize to tray"
                                           FontSize="12" Foreground="{DynamicResource TextSecondary}" />
                            </Grid>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="140" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <TextBlock Grid.Column="0" Text="Ctrl+Shift+E" FontFamily="Consolas"
                                           FontSize="12" Foreground="{DynamicResource AccentPrimary}" />
                                <TextBlock Grid.Column="1" Text="Run selected tool"
                                           FontSize="12" Foreground="{DynamicResource TextSecondary}" />
                            </Grid>
                        </StackPanel>
                    </Border>

                    <!-- Reset to Defaults -->
                    <Button Content="Reset All Settings to Defaults" Padding="12,8"
                            HorizontalAlignment="Left"
                            Command="{Binding ResetToDefaultsCommand}"
                            Background="{DynamicResource ErrorColor}"
                            Foreground="{DynamicResource TextOnAccent}"
                            BorderThickness="0" Cursor="Hand" FontSize="13">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}"
                                        CornerRadius="6" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                </Border>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </StackPanel>
            </Border>
        </StackPanel>
    </ScrollViewer>
</UserControl>
